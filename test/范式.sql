
use liuq;
DROP TABLE IF EXISTS 选课表_反例;
DROP TABLE IF EXISTS 选课表_1NF;
DROP TABLE IF EXISTS 选课成绩表_2NF;
DROP TABLE IF EXISTS 学生表_2NF;
DROP TABLE IF EXISTS 课程表_2NF;
DROP TABLE IF EXISTS 选课成绩表_3NF;
DROP TABLE IF EXISTS 课程表_3NF;
DROP TABLE IF EXISTS 学生表_3NF;
DROP TABLE IF EXISTS 班级表_3NF;

/*- =====================================================================
一、不满足 1NF 的表（反例）
先看 “连 1NF 都达不到” 的情况，再看 1NF 的修正：
-- =====================================================================*/

-- 反例：属性未原子化（不满足1NF）
CREATE TABLE 选课表_反例 (
  学号 INT,
  学生信息 VARCHAR(50), -- 复合属性：包含“姓名+班级+班主任”（如“张三+高三1班+李老师”）
  课程信息 VARCHAR(50), -- 复合属性：包含“课程号+课程名”（如“001+数学”）
  成绩 INT
);

-- 问题：学生信息和课程信息是复合属性，可拆分（如 “学生信息” 能拆成姓名、班级、班主任），不满足 “原子性”。

/*- =====================================================================
-- 二、满足 1NF 的表（但不满足 2NF）
-- 修正复合属性，让所有属性不可拆分，即达到 1NF，但存在 “部分函数依赖”：
-- =====================================================================*/
-- 满足1NF，但不满足2NF（有部分函数依赖）
CREATE TABLE 选课表_1NF (
  学号 INT,
  课程号 INT,
  姓名 VARCHAR(20), -- 非主属性
  班级 VARCHAR(20), -- 非主属性
  班主任 VARCHAR(20), -- 非主属性
  课程名 VARCHAR(20), -- 非主属性
  成绩 INT, -- 非主属性
  PRIMARY KEY (学号, 课程号) -- 复合主键（唯一确定一条选课记录）
);

/*
分析：
满足 1NF：所有属性（学号、课程号、姓名等）均不可拆分（原子性）；
不满足 2NF：存在 “部分函数依赖”——非主属性仅依赖复合主键的一部分：
	（1）姓名、班级、班主任 仅依赖 学号（和课程号无关：一个学生的姓名/班级不会因选不同课而变）；
	（2）课程名 仅依赖 课程号（和学号无关：一门课的名称不会因学生不同而变）；
	（3）只有 成绩 完全依赖复合主键（学号 + 课程号唯一确定成绩）。
	
存在的异常：
冗余：同一学生选10门课，姓名/班级会重复存储10次；同一课程被100人选，课程名会重复100次；
更新异常：修改学生姓名时，需更新该学生所有选课记录，漏更会导致数据不一致；
插入异常：若想新增一门课程（还没人选），因主键（学号 + 课程号）缺一不可，无法插入。
	
*/

/*- =====================================================================
 三、满足 2NF 的表（但不满足 3NF）
 在 1NF 基础上，拆分表消除部分函数依赖（按 “完全依赖” 分组），但存在 “传递函数依赖”：
-- =====================================================================*/
DROP TABLE IF EXISTS 选课成绩表_2NF;
DROP TABLE IF EXISTS 学生表_2NF;
DROP TABLE IF EXISTS 课程表_2NF;

-- 表1：学生表（主键：学号）—— 存储学生相关信息（完全依赖学号）
CREATE TABLE 学生表_2NF (
  学号 INT PRIMARY KEY,
  姓名 VARCHAR(20),
  班级 VARCHAR(20),
  班主任 VARCHAR(20) -- 非主属性：依赖班级（班级→班主任），存在传递依赖
);

-- 表2：课程表（主键：课程号）—— 存储课程相关信息（完全依赖课程号）
CREATE TABLE 课程表_2NF (
  课程号 INT PRIMARY KEY,
  课程名 VARCHAR(20)
);

-- 表3：选课成绩表（主键：学号+课程号）—— 存储选课关系（完全依赖复合主键）
CREATE TABLE 选课成绩表_2NF (
  学号 INT,
  课程号 INT,
  成绩 INT,
  PRIMARY KEY (学号, 课程号),
  FOREIGN KEY (学号) REFERENCES 学生表_2NF(学号),
  FOREIGN KEY (课程号) REFERENCES 课程表_2NF(课程号)
);

/*
分析：
满足 2NF：
	所有表都满足 1NF；
	非主属性均 “完全依赖” 主键：
		（1）学生表：姓名、班级、班主任完全依赖学号；
		（2）课程表：课程名完全依赖课程号；
		（3）选课成绩表：成绩完全依赖（学号 + 课程号）；
不满足 3NF：学生表中存在 “传递函数依赖”—— 主键（学号）→ 中间属性（班级）→ 非主属性（班主任），且 “班级” 不是主键、“班主任” 不是主键的一部分。

存在的异常：
冗余：同一班级有 50 名学生，班主任会重复存储 50 次；
更新异常：修改班级班主任时，需更新该班级所有学生记录，漏更会导致数据不一致；
插入异常：若想新增一个班级（还没学生），因学生表主键是学号，无法插入班级和班主任信息。
*/

/*- =====================================================================
四、满足 3NF 的表（最终优化）
在 2NF 基础上，拆分表消除传递函数依赖（将传递依赖的中间属性和非主属性独立成表）：
-- =====================================================================*/
DROP TABLE IF EXISTS 选课成绩表_3NF;
DROP TABLE IF EXISTS 课程表_3NF;
DROP TABLE IF EXISTS 学生表_3NF;
DROP TABLE IF EXISTS 班级表_3NF;

-- 表1：学生表（主键：学号）—— 仅存储学生与班级的关联（无传递依赖）
CREATE TABLE 学生表_3NF (
  学号 INT PRIMARY KEY,
  姓名 VARCHAR(20),
  班级 VARCHAR(20) -- 非主属性：直接依赖学号，无传递
);

-- 表2：班级表（主键：班级）—— 存储班级与班主任的关联（独立拆分）
CREATE TABLE 班级表_3NF (
  班级 VARCHAR(20) PRIMARY KEY,
  班主任 VARCHAR(20) -- 非主属性：直接依赖班级（主键），无传递
);

-- 表3：课程表（主键：课程号）—— 无变化（本身无传递依赖）
CREATE TABLE 课程表_3NF (
  课程号 INT PRIMARY KEY,
  课程名 VARCHAR(20)
);

-- 表4：选课成绩表（主键：学号+课程号）—— 无变化（本身无传递依赖）
CREATE TABLE 选课成绩表_3NF (
  学号 INT,
  课程号 INT,
  成绩 INT,
  PRIMARY KEY (学号, 课程号),
  FOREIGN KEY (学号) REFERENCES 学生表_3NF(学号),
  FOREIGN KEY (课程号) REFERENCES 课程表_3NF(课程号)
);

/*
分析：
满足 3NF：
	所有表满足 2NF；
	无传递函数依赖：
			（1）学生表：姓名、班级直接依赖学号（无中间属性）；
			（2）班级表：班主任直接依赖班级（主键）；
			（3）课程表、选课成绩表同理，无传递依赖；
解决所有异常：
无冗余：班主任仅存储 1 次 / 班级，课程名仅存储 1 次 / 课程；
更新异常：修改班主任只需改班级表 1 条记录，修改课程名只需改课程表 1 条记录；
插入异常：可单独插入班级（班级表）、课程（课程表），无需依赖学生或选课记录。

核心对比总结（表格版）
	范式	表结构特征	关键依赖问题	典型异常	核心优化动作
	1NF		属性原子化，无复合属性	存在部分函数依赖（复合主键场景）	冗余严重、更新 / 插入 / 删除异常	无（仅保证属性不可拆）
	2NF		拆分表，非主属性完全依赖主键	存在传递函数依赖	部分冗余、传递更新异常	消除部分函数依赖（按完全依赖分组拆表）
	3NF		进一步拆分表，非主属性无传递依赖	无部分 / 传递依赖	无明显异常（冗余最低

简单记忆：1NF 拆属性，2NF 拆部分依赖，3NF 拆传递依赖，最终实现 “一事一表”，数据冗余最小、一致性最高。
*/
=================================================================================================================
-- END
-- =================================================================================================================

