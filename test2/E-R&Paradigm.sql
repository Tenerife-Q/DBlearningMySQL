-- ═══════════════════════════════════════════════════════════════════════════════
-- 📚 Day 2 补充：范式、E-R图及其他重要知识点
-- 📅 复习日期：2025-12-27
-- 🎯 目标：掌握数据库设计理论（范式、E-R图）+ 查漏补缺
-- ═══════════════════════════════════════════════════════════════════════════════


-- ═══════════════════════════════════════════════════════════════════════════════
-- 第一部分：关系数据库规范化理论（范式）
-- ═══════════════════════════════════════════════════════════════════════════════

/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           📚 范式概述                                            │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  【什么是范式】                                                                  │
│  范式是关系数据库设计的规范化标准，用于减少数据冗余、消除异常问题。              │
│  范式级别越高，数据冗余越少，但查询可能需要更多的连接操作。                      │
│                                                                                 │
│  【范式层级关系】                                                                │
│  1NF ⊂ 2NF ⊂ 3NF ⊂ BCNF ⊂ 4NF ⊂ 5NF                                           │
│  （高级范式必须先满足低级范式的要求）                                           │
│                                                                                 │
│  【考试重点】通常考到 1NF、2NF、3NF，偶尔考 BCNF                                │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
*/


-- =============================================================================
-- 1.1 基本概念
-- =============================================================================

/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           关键术语                                               │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  【函数依赖 Functional Dependency】                                              │
│  如果 A 的值能唯一确定 B 的值，则称 B 函数依赖于 A，记作：A → B                 │
│                                                                                 │
│  例如：学号 → 姓名（知道学号就能确定姓名）                                      │
│       (学号, 课程号) → 成绩（知道学号和课程号就能确定成绩）                     │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  【完全函数依赖 vs 部分函数依赖】                                                │
│                                                                                 │
│  完全函数依赖：B 依赖于 A 的全部，去掉任何一部分都不行                          │
│  记作：A ──F→ B                                                                 │
│  例如：(学号, 课程号) ──F→ 成绩                                                 │
│        必须同时知道学号和课程号才能确定成绩                                     │
│                                                                                 │
│  部分函数依赖：B 只依赖于 A 的一部分                                            │
│  记作：A ──P→ B                                                                 │
│  例如：(学号, 课程号) ──P→ 姓名                                                 │
│        只需要学号就能确定姓名，不需要课程号                                     │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  【传递函数依赖】                                                                │
│  如果 A → B，B → C，且 B ↛ A，则称 C 传递依赖于 A                               │
│  记作：A ──T→ C                                                                 │
│                                                                                 │
│  例如：学号 → 系别，系别 → 系主任                                               │
│        则：学号 ──T→ 系主任（学号传递决定系主任）                               │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  【候选键 Candidate Key】                                                        │
│  能够唯一标识元组的最小属性集合（可能有多个）                                   │
│                                                                                 │
│  【主键 Primary Key】                                                            │
│  从候选键中选择一个作为主键                                                     │
│                                                                                 │
│  【主属性 vs 非主属性】                                                          │
│  主属性：包含在任何一个候选键中的属性                                           │
│  非主属性：不包含在任何候选键中的属性                                           │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
*/


-- =============================================================================
-- 1.2 第一范式 (1NF)
-- =============================================================================

/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           第一范式 1NF                                           │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  【定义】每个属性都是不可再分的原子值（属性不可分）                              │
│                                                                                 │
│  【通俗理解】每个格子里只能填一个值，不能填多个值或嵌套表                        │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  ❌ 不满足 1NF 的例子：                                                          │
│                                                                                 │
│  │ 学号  │ 姓名 │ 电话                    │                                     │
│  │ 001   │ 张三 │ 13800001111, 13900002222│  ← 电话字段包含多个值               │
│                                                                                 │
│  │ 学号  │ 姓名 │ 课程信息                │                                     │
│  │ 001   │ 张三 │ {数据库: 85, 数学:90}    │  ← 嵌套结构                         │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  ✅ 满足 1NF 的改进：                                                            │
│                                                                                 │
│  方法1：拆成多行                                                                 │
│  │ 学号  │ 姓名 │ 电话        │                                                 │
│  │ 001   │ 张三 │ 13800001111 │                                                 │
│  │ 001   │ 张三 │ 13900002222 │                                                 │
│                                                                                 │
│  方法2：拆成多列（仅当数量固定时）                                              │
│  │ 学号  │ 姓名 │ 电话1       │ 电话2       │                                   │
│  │ 001   │ 张三 │ 13800001111 │ 13900002222 │                                   │
│                                                                                 │
│  方法3：拆成独立的表                                                             │
│  学生表：(学号, 姓名)                                                           │
│  电话表：(学号, 电话)                                                           │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
*/


-- =============================================================================
-- 1.3 第二范式 (2NF)
-- =============================================================================

/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           第二范式 2NF                                           │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  【定义】满足 1NF，且不存在非主属性对候选键的部分函数依赖                        │
│                                                                                 │
│  【通俗理解】非主属性必须完全依赖于整个主键，不能只依赖主键的一部分              │
│                                                                                 │
│  【适用场景】主要针对联合主键的情况                                              │
│             如果主键是单属性，自动满足 2NF                                       │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  ❌ 不满足 2NF 的例子：                                                          │
│                                                                                 │
│  选课表 SC (学号, 课程号, 成绩, 姓名, 课程名)                                   │
│  主键：(学号, 课程号)                                                           │
│                                                                                 │
│  函数依赖：                                                                      │
│  (学号, 课程号) → 成绩     ✅ 完全依赖                                          │
│  学号 → 姓名               ❌ 部分依赖（只依赖学号）                            │
│  课程号 → 课程名           ❌ 部分依赖（只依赖课程号）                          │
│                                                                                 │
│  问题：                                                                          │
│  1. 数据冗余：张三选了3门课，姓名重复存储3次                                    │
│  2. 插入异常：新学生没选课就无法插入                                            │
│  3. 删除异常：学生退选所有课程，学生信息也丢失                                  │
│  4. 更新异常：改名需要改多行                                                    │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  ✅ 分解为满足 2NF：                                                             │
│                                                                                 │
│  学生表 Student (学号, 姓名)           ← 消除对学号的部分依赖                   │
│  课程表 Course (课程号, 课程名)        ← 消除对课程号的部分依赖                 │
│  选课表 SC (学号, 课程号, 成绩)        ← 只保留完全依赖的属性                   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
*/


-- =============================================================================
-- 1.4 第三范式 (3NF)
-- =============================================================================

/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           第三范式 3NF                                           │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  【定义】满足 2NF，且不存在非主属性对候选键的传递函数依赖                        │
│                                                                                 │
│  【通俗理解】非主属性之间不能有依赖关系，都必须直接依赖于主键                    │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  ❌ 不满足 3NF 的例子：                                                          │
│                                                                                 │
│  学生表 Student (学号, 姓名, 系别, 系主任)                                      │
│  主键：学号                                                                      │
│                                                                                 │
│  函数依赖：                                                                      │
│  学号 → 姓名       ✅ 直接依赖                                                  │
│  学号 → 系别       ✅ 直接依赖                                                  │
│  系别 → 系主任     ← 非主属性之间的依赖！                                       │
│  学号 → 系主任     ❌ 传递依赖（学号→系别→系主任）                              │
│                                                                                 │
│  问题：                                                                          │
│  1. 数据冗余：CS系100个学生，"系主任"重复存储100次                              │
│  2. 插入异常：新建系没有学生就无法插入系主任信息                                │
│  3. 删除异常：系里所有学生毕业，系主任信息也丢失                                │
│  4. 更新异常：换系主任需要改很多行                                              │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  ✅ 分解为满足 3NF：                                                             │
│                                                                                 │
│  学生表 Student (学号, 姓名, 系别)     ← 去掉传递依赖的属性                     │
│  系表 Department (系别, 系主任)        ← 新建表存储系信息                       │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
*/


-- =============================================================================
-- 1.5 BCNF (Boyce-Codd Normal Form)
-- =============================================================================

/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           BCNF 范式                                              │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  【定义】满足 3NF，且每个决定因素都是候选键                                      │
│                                                                                 │
│  【通俗理解】箭头左边必须是候选键（即 A → B 中，A 必须是候选键）                │
│                                                                                 │
│  【与 3NF 的区别】                                                               │
│  3NF：非主属性不能传递依赖于候选键                                              │
│  BCNF：所有属性（包括主属性）都不能传递依赖于候选键                             │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  ❌ 满足 3NF 但不满足 BCNF 的例子：                                              │
│                                                                                 │
│  授课表 (学生, 课程, 教师)                                                      │
│  规则：每门课只有一个教师教                                                     │
│        一个学生一门课只能选一个教师                                             │
│                                                                                 │
│  候选键：(学生, 课程) 或 (学生, 教师)                                           │
│                                                                                 │
│  函数依赖：                                                                      │
│  (学生, 课程) → 教师                                                            │
│  (学生, 教师) → 课程                                                            │
│  教师 → 课程        ❌ 教师不是候选键，但决定了课程                             │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  ✅ 分解为满足 BCNF：                                                            │
│                                                                                 │
│  教师课程表 (教师, 课程)        ← 教师是主键                                    │
│  选课表 (学生, 教师)            ← (学生, 教师) 是主键                           │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
*/


-- =============================================================================
-- 1.6 范式总结对比
-- =============================================================================

/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           范式对比总结                                           │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  │ 范式 │ 要求                              │ 消除的问题                       │
│  │──────────────────────────────────────────────────────────────────────────── │
│  │ 1NF  │ 属性不可分（原子性）              │ 重复组、嵌套表                   │
│  │ 2NF  │ 消除非主属性对键的部分依赖        │ 联合主键中的部分依赖             │
│  │ 3NF  │ 消除非主属性对键的传递依赖        │ 非主属性之间的依赖               │
│  │ BCNF │ 每个决定因素都是候选键            │ 主属性对键的依赖问题             │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  【判断方法速记】                                                                │
│                                                                                 │
│  1NF：看有没有"多值属性"或"嵌套"                                               │
│  2NF：看非主属性是否依赖于"部分主键"（针对联合主键）                            │
│  3NF：看非主属性之间是否有"依赖关系"（A→B→C 的传递）                           │
│  BCNF：看所有"箭头左边"是否都是候选键                                           │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  【分解原则】                                                                    │
│                                                                                 │
│  1. 无损连接：分解后能通过自然连接恢复原表                                      │
│  2. 保持函数依赖：分解后的表能保持原有的函数依赖关系                            │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
*/


-- ═══════════════════════════════════════════════════════════════════════════════
-- 第二部分：E-R 图（实体-联系图）
-- ═══════════════════════════════════════════════════════════════════════════════

/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           📚 E-R 图概述                                          │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  【什么是 E-R 图】                                                               │
│  E-R 图（Entity-Relationship Diagram）是一种数据库概念设计工具，               │
│  用图形化方式描述实体、属性和实体之间的联系。                                   │
│                                                                                 │
│  【作用】                                                                        │
│  1. 需求分析阶段：与用户沟通，理解业务需求                                      │
│  2. 概念设计阶段：建立概念模型，独立于具体 DBMS                                 │
│  3. 逻辑设计阶段：转换为关系模式（表结构）                                      │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
*/


-- =============================================================================
-- 2.1 E-R 图基本元素
-- =============================================================================

/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           E-R 图基本元素                                         │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  【三大基本元素】                                                                │
│                                                                                 │
│  1. 实体 (Entity) ─── 用【矩形】表示                                            │
│     表示现实世界中可区分的对象                                                  │
│     例如：学生、课程、教师、部门                                                │
│                                                                                 │
│         ┌────────┐                                                              │
│         │  学生  │                                                              │
│         └────────┘                                                              │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  2. 属性 (Attribute) ─── 用【椭圆】表示                                         │
│     实体的特征或性质                                                            │
│     例如：学号、姓名、年龄                                                      │
│                                                                                 │
│            (学号)    (姓名)    (年龄)                                           │
│              │         │         │                                              │
│              └────┬────┴────┬────┘                                              │
│                   │         │                                                   │
│              ┌────┴─────────┴────┐                                              │
│              │       学生        │                                              │
│              └───────────────────┘                                              │
│                                                                                 │
│     📌 主键属性用【下划线】标注：(学号)                                         │
│                                  ─────                                          │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  3. 联系 (Relationship) ─── 用【菱形】表示                                      │
│     实体之间的关联关系                                                          │
│     例如：选课、授课、隶属                                                      │
│                                                                                 │
│         ┌────────┐           ┌────────┐                                         │
│         │  学生  │───◇选课───│  课程  │                                         │
│         └────────┘           └────────┘                                         │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
*/


-- =============================================================================
-- 2.2 联系的类型（重点！）
-- =============================================================================

/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           联系的类型                                             │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  【1: 1 一对一联系】                                                              │
│                                                                                 │
│  一个 A 实体对应一个 B 实体，一个 B 实体也对应一个 A 实体                       │
│                                                                                 │
│  例如：一个班级只有一个班长，一个班长只属于一个班级                             │
│                                                                                 │
│         ┌────────┐    1      1    ┌────────┐                                    │
│         │  班级  │────◇管理────│  班长  │                                    │
│         └────────┘              └────────┘                                    │
│                                                                                 │
│  转换为关系模式：                                                                │
│  方法1：合并为一个表                                                            │
│  方法2：外键放在任意一方                                                        │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  【1:n 一对多联系】                                                              │
│                                                                                 │
│  一个 A 实体对应多个 B 实体，一个 B 实体只对应一个 A 实体                       │
│                                                                                 │
│  例如：一个班级有多个学生，一个学生只属于一个班级                               │
│                                                                                 │
│         ┌────────┐    1      n    ┌────────┐                                    │
│         │  班级  │────◇包含────│  学生  │                                    │
│         └────────┘              └────────┘                                    │
│                                                                                 │
│  转换为关系模式：                                                                │
│  外键放在"多"的一方（学生表中加班级ID）                                        │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  【m:n 多对多联系】                                                              │
│                                                                                 │
│  一个 A 实体对应多个 B 实体，一个 B 实体也对应多个 A 实体                       │
│                                                                                 │
│  例如：一个学生可选多门课程，一门课程可被多个学生选                             │
│                                                                                 │
│         ┌────────┐    m      n    ┌────────┐                                    │
│         │  学生  │────◇选课────│  课程  │                                    │
│         └────────┘    │         └────────┘                                    │
│                       │                                                         │
│                     (成绩)  ← 联系也可以有属性                                  │
│                                                                                 │
│  转换为关系模式：                                                                │
│  必须新建一个关联表（选课表），包含双方主键 + 联系的属性                        │
│  SC(学号, 课程号, 成绩)                                                         │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
*/


-- =============================================================================
-- 2.3 E-R 图转换为关系模式
-- =============================================================================

/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           E-R 图转换规则                                         │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  【规则 1】每个实体转换为一个关系（表）                                          │
│                                                                                 │
│  实体的属性 → 表的列                                                            │
│  实体的主键 → 表的主键                                                          │
│                                                                                 │
│  例如：学生(学号, 姓名, 年龄) → Student(sno, sname, sage)                       │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  【规则 2】1:1 联系的转换                                                        │
│                                                                                 │
│  方法1：合并为一个表                                                            │
│  方法2：外键加在任意一方                                                        │
│  方法3：独立建联系表（不推荐）                                                  │
│                                                                                 │
│  例如：班级(1)──管理──(1)班长                                                  │
│  → Class(class_id, class_name, monitor_id)                                     │
│    或 Monitor(student_id, name, class_id)                                      │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  【规则 3】1:n 联系的转换                                                        │
│                                                                                 │
│  外键加在"n"的一方（多的一方）                                                 │
│                                                                                 │
│  例如：部门(1)──隶属──(n)员工                                                  │
│  → Department(dept_id, dept_name)                                              │
│    Employee(emp_id, emp_name, dept_id)  ← 外键在员工表                         │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  【规则 4】m:n 联系的转换（重点！）                                              │
│                                                                                 │
│  必须新建一个关联表，包含：                                                     │
│  1. 双方实体的主键（作为联合主键或外键）                                        │
│  2. 联系自身的属性                                                              │
│                                                                                 │
│  例如：学生(m)──选课──(n)课程，联系属性：成绩                                  │
│  → Student(sno, sname)                                                         │
│    Course(cno, cname)                                                          │
│    SC(sno, cno, grade)  ← 关联表，主键为(sno, cno)                             │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
*/


-- =============================================================================
-- 2.4 E-R 图完整示例
-- =============================================================================

/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           E-R 图示例：学生选课系统                               │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  【需求描述】                                                                    │
│  1. 学生有学号、姓名、年龄、所在系                                              │
│  2. 课程有课程号、课程名、学分                                                  │
│  3. 一个学生可以选多门课程                                                      │
│  4. 一门课程可以被多个学生选                                                    │
│  5. 每个学生每门课有一个成绩                                                    │
│  6. 每个系有多个学生，每个学生只属于一个系                                      │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  【E-R 图】                                                                      │
│                                                                                 │
│    (系号)  (系名)                                                               │
│      │      │                                                                   │
│      └──┬───┘                                                                   │
│         │                                                                       │
│    ┌────┴────┐      1                                                           │
│    │   系    │──────────┐                                                       │
│    └─────────┘          │                                                       │
│                         ◇ 隶属                                                  │
│                         │                                                       │
│    ┌─────────┐      n   │     m          n    ┌─────────┐                       │
│    │  学生   │──────────┴─────────◇选课──────│  课程   │                       │
│    └─────────┘                    │          └─────────┘                       │
│      │  │  │                    (成绩)          │  │  │                         │
│   (学号)(姓名)(年龄)                        (课程号)(课程名)(学分)              │
│    ────                                      ──────                             │
│   (带下划线表示主键)                                                            │
│                                                                                 │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                 │
│  【转换为关系模式】                                                              │
│                                                                                 │
│  Department(dno, dname)                  -- 系表                                │
│  Student(sno, sname, sage, dno)          -- 学生表，dno 是外键                  │
│  Course(cno, cname, credit)              -- 课程表                              │
│  SC(sno, cno, grade)                     -- 选课表，联合主键                    │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
*/


-- ═══════════════════════════════════════════════════════════════════════════════
-- 第三部分：其他可能遗漏的知识点
-- ═══════════════════════════════════════════════════════════════════════════════

-- =============================================================================
-- 3.1 视图 (View)
-- =============================================================================

/*
【什么是视图】
视图是一个虚拟表，基于 SELECT 查询定义，不存储实际数据。

【作用】
1. 简化复杂查询
2. 提供数据安全性（只暴露部分数据）
3. 提供逻辑数据独立性
*/

-- 创建视图
CREATE VIEW v_student_course AS
SELECT s.sno, s.sname, c.cname, sc.grade
FROM student s
JOIN sc ON s.sno = sc.sno
JOIN course c ON sc.cno = c.cno;

-- 使用视图（像表一样查询）
SELECT * FROM v_student_course WHERE grade > 80;

-- 删除视图
DROP VIEW IF EXISTS v_student_course;

-- 📌 视图的特点：
-- 1. 视图是虚拟表，不存储数据
-- 2. 对视图的查询会转换为对基表的查询
-- 3. 简单视图可以进行增删改操作
-- 4. 包含聚合函数、GROUP BY、DISTINCT 等的视图通常不可更新


-- =============================================================================
-- 3.2 索引 (Index)
-- =============================================================================

/*
【什么是索引】
索引是一种数据结构，用于加速数据检索，类似书的目录。

【作用】
1. 加快查询速度（SELECT）
2. 加快排序和分组（ORDER BY, GROUP BY）
3. 保证唯一性（UNIQUE INDEX）
*/

-- 创建索引
CREATE INDEX idx_sname ON student(sname);           -- 普通索引
CREATE UNIQUE INDEX idx_phone ON student(phone);    -- 唯一索引
CREATE INDEX idx_dept_age ON student(sdept, sage);  -- 复合索引

-- 删除索引
DROP INDEX idx_sname ON student;

-- 查看表的索引
SHOW INDEX FROM student;

/*
📌 索引的优缺点：
优点：加快查询速度
缺点：占用存储空间，降低增删改速度

📌 适合建索引的列：
1. 主键列（自动创建）
2. 外键列
3. 经常用于 WHERE 条件的列
4. 经常用于 ORDER BY、GROUP BY 的列

📌 不适合建索引的列：
1. 很少用于查询的列
2. 数据值很少的列（如性别）
3. 频繁更新的列
*/


-- =============================================================================
-- 3.3 数据库设计步骤
-- =============================================================================

/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           数据库设计六个阶段                                     │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  1. 需求分析                                                                     │
│     - 分析用户需求，确定系统边界                                                │
│     - 产出：数据字典、数据流图                                                  │
│                                                                                 │
│  2. 概念结构设计                                                                 │
│     - 建立 E-R 模型                                                             │
│     - 产出：E-R 图                                                              │
│                                                                                 │
│  3. 逻辑结构设计                                                                 │
│     - 将 E-R 图转换为关系模式                                                   │
│     - 进行规范化处理（范式）                                                    │
│     - 产出：关系模式（表结构）                                                  │
│                                                                                 │
│  4. 物理结构设计                                                                 │
│     - 确定存储结构和存取方法                                                    │
│     - 设计索引                                                                  │
│     - 产出：物理存储方案                                                        │
│                                                                                 │
│  5. 数据库实施                                                                   │
│     - 建立数据库                                                                │
│     - 编写应用程序                                                              │
│     - 数据装载                                                                  │
│                                                                                 │
│  6. 数据库运行和维护                                                             │
│     - 性能监控和调优                                                            │
│     - 备份恢复                                                                  │
│     - 安全管理                                                                  │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
*/


-- ═══════════════════════════════════════════════════════════════════════════════
-- 第四部分：范式与 E-R 图练习题
-- ═══════════════════════════════════════════════════════════════════════════════

/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 1：判断范式级别                                                          │
│ 以下关系模式属于第几范式？为什么？                                               │
└─────────────────────────────────────────────────────────────────────────────────┘

关系：学生(学号, 姓名, 系别, 系主任, 课程号, 成绩)
主键：(学号, 课程号)

分析：
- 学号 → 姓名        （部分依赖）
- 学号 → 系别        （部分依赖）
- 系别 → 系主任      （传递依赖）

答案：_______ NF

原因：存在非主属性对主键的 _______ 依赖
*/




/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 2：分解为 3NF                                                            │
│ 将以下关系分解为满足 3NF 的模式                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

原关系：员工(员工号, 姓名, 部门号, 部门名, 部门经理)
主键：员工号

函数依赖：
员工号 → 姓名
员工号 → 部门号
部门号 → 部门名
部门号 → 部门经理

请分解：

表1：_______(_______，_______, _______)

表2：_______(_______，_______, _______)
*/




/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 3：E-R 图转换                                                            │
│ 根据以下描述画出 E-R 图并转换为关系模式                                          │
└─────────────────────────────────────────────────────────────────────────────────┘

描述：
1. 医生有工号、姓名、科室
2. 患者有病历号、姓名、年龄
3. 一个医生可以诊治多个患者
4. 一个患者可以被多个医生诊治
5. 每次诊治有诊治日期和诊断结果

问题1：医生和患者之间是什么类型的联系？ _______

问题2：转换后有几个表？ _______

问题3：写出所有表的结构：

表1：医生(_______，_______, _______)

表2：患者(_______，_______, _______)

表3：_______(_______，_______, _______, _______)
*/




/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 4：联系类型判断                                                          │
│ 判断以下场景属于哪种联系类型（1:1, 1:n, m:n）                                    │
└─────────────────────────────────────────────────────────────────────────────────┘

1. 一个人只有一个身份证，一个身份证只属于一个人          _______

2. 一个部门有多个员工，一个员工只属于一个部门            _______

3. 一个学生可以参加多个社团，一个社团有多个学生          _______

4. 一个订单包含多个商品，一个商品可以属于多个订单        _______

5. 一个国家只有一个首都，一个首都只属于一个国家          _______

6. 一个老师可以教多门课，一门课只由一个老师教            _______
*/




/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 5：函数依赖分析                                                          │
│ 根据以下关系，找出所有函数依赖并判断范式级别                                     │
└─────────────────────────────────────────────────────────────────────────────────┘

关系：订单明细(订单号, 商品号, 商品名, 单价, 数量, 金额)

已知：
- (订单号, 商品号) 是主键
- 一个商品有固定的商品名和单价
- 金额 = 单价 × 数量

函数依赖：

(订单号, 商品号) → _______

商品号 → _______, _______

这个关系属于第 _______ 范式

存在的问题是：非主属性 _______ 和 _______ 对主键存在 _______ 依赖
*/




/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 6：外键位置判断                                                          │
│ 根据联系类型，判断外键应该放在哪个表中                                           │
└─────────────────────────────────────────────────────────────────────────────────┘

1. 班级(1) ── 包含 ── (n)学生
   外键放在 _______ 表中

2. 学生(m) ── 选课 ── (n)课程  
   需要新建 _______ 表

3. 员工(1) ── 拥有 ── (1)工位
   外键可以放在 _______ 表中
*/




-- ═══════════════════════════════════════════════════════════════════════════════
-- 第五部分：练习题答案
-- ═══════════════════════════════════════════════════════════════════════════════

/*
【题目 1 答案】
答案：1NF
原因：存在非主属性对主键的部分依赖
     （姓名、系别只依赖于学号，不依赖于课程号）


【题目 2 答案】
表1：员工(员工号，姓名，部门号)
表2：部门(部门号，部门名，部门经理)


【题目 3 答案】
问题1：m:n（多对多）
问题2：3个表
表1：医生(工号，姓名，科室)
表2：患者(病历号，姓名，年龄)
表3：诊治(工号，病历号，诊治日期，诊断结果)


【题目 4 答案】
1. 1:1
2. 1:n
3. m:n
4. m:n
5. 1:1
6. 1:n


【题目 5 答案】
(订单号, 商品号) → 数量, 金额
商品号 → 商品名, 单价
这个关系属于第 1 范式
存在的问题是：非主属性 商品名 和 单价 对主键存在 部分 依赖


【题目 6 答案】
1. 外键放在 学生 表中
2. 需要新建 选课(SC) 表
3. 外键可以放在 任意一方 表中（员工或工位都行）
*/


-- ═══════════════════════════════════════════════════════════════════════════════
-- 📚 知识点速查表
-- ═══════════════════════════════════════════════════════════════════════════════

/*
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           📚 范式与 E-R 图速查表                                 │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  【范式判断速记】                                                                │
│  ─────────────────────────────────────────────────────────────────────────────  │
│  1NF → 属性不可分（原子性）                                                     │
│  2NF → 消除非主属性对键的【部分依赖】（针对联合主键）                           │
│  3NF → 消除非主属性对键的【传递依赖】                                           │
│  BCNF → 所有决定因素都是候选键                                                  │
│                                                                                 │
│  【E-R 图元素】                                                                  │
│  ─────────────────────────────────────────────────────────────────────────────  │
│  矩形 → 实体                                                                    │
│  椭圆 → 属性（主键加下划线）                                                    │
│  菱形 → 联系                                                                    │
│                                                                                 │
│  【联系转换规则】                                                                │
│  ─────────────────────────────────────────────────────────────────────────────  │
│  1:1 → 外键放任意一方，或合并                                                   │
│  1:n → 外键放"n"的一方                                                         │
│  m:n → 必须新建关联表                                                           │
│                                                                                 │
│  【函数依赖记号】                                                                │
│  ─────────────────────────────────────────────────────────────────────────────  │
│  A → B    完全函数依赖                                                          │
│  A ──P→ B  部分函数依赖                                                         │
│  A ──T→ B  传递函数依赖                                                         │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

🎉 补充内容完成！祝你考试顺利！💪
*/