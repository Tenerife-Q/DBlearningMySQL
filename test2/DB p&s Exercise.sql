-- ═══════════════════════════════════════════════════════════════════════════════
-- 📝 Day 2 数据库编程填空练习题
-- 📅 练习日期：2025-12-27
-- 🎯 重点：存储过程、存储函数、游标、触发器的语法细节与易错点
-- ═══════════════════════════════════════════════════════════════════════════════


-- ═══════════════════════════════════════════════════════════════════════════════
-- 测试数据准备
-- ═══════════════════════════════════════════════════════════════════════════════

DROP DATABASE IF EXISTS exam_practice;
CREATE DATABASE exam_practice DEFAULT CHARSET utf8mb4;
USE exam_practice;

-- 学生表
CREATE TABLE student (
    sno CHAR(9) PRIMARY KEY,
    sname VARCHAR(20) NOT NULL,
    sage INT,
    sdept VARCHAR(20)
);

-- 课程表
CREATE TABLE course (
    cno CHAR(4) PRIMARY KEY,
    cname VARCHAR(40) NOT NULL,
    ccredit INT DEFAULT 2
);

-- 选课表
CREATE TABLE sc (
    sno CHAR(9),
    cno CHAR(4),
    grade INT,
    PRIMARY KEY (sno, cno),
    FOREIGN KEY (sno) REFERENCES student(sno),
    FOREIGN KEY (cno) REFERENCES course(cno)
);

-- 插入测试数据
INSERT INTO student VALUES 
    ('001', '张三', 20, 'CS'),
    ('002', '李四', 21, 'CS'),
    ('003', '王五', 19, 'MA');

INSERT INTO course VALUES 
    ('C1', '数据库', 4),
    ('C2', '数学', 3),
    ('C3', '英语', 2);

INSERT INTO sc VALUES 
    ('001', 'C1', 85),
    ('001', 'C2', 90),
    ('002', 'C1', 78),
    ('003', 'C1', 92),
    ('003', 'C3', 88);


-- ═══════════════════════════════════════════════════════════════════════════════
-- 第一部分：存储过程填空题（10题）
-- ═══════════════════════════════════════════════════════════════════════════════

/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 1                                                                    │
│ 补全存储过程：根据学号查询学生姓名，通过输出参数返回                          │
│ 考点：OUT 参数、SELECT INTO 语法                                             │
└─────────────────────────────────────────────────────────────────────────────┘
*/

DROP PROCEDURE IF EXISTS GetStudentName;

DELIMITER //
CREATE PROCEDURE GetStudentName(
    IN p_sno CHAR(9),
    _______ p_name VARCHAR(20)           -- 填空1：参数类型关键字
)
BEGIN
    SELECT sname _______ p_name          -- 填空2：赋值关键字
    FROM student 
    WHERE sno = p_sno;
END //
DELIMITER ;

填空1：__out__
填空2：__into__




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 2                                                                    │
│ 补全存储过程：声明局部变量并赋值                                              │
│ 考点：DECLARE 语法、SET 赋值                                                 │
└─────────────────────────────────────────────────────────────────────────────┘
*/

DROP PROCEDURE IF EXISTS VarDemo;

DELIMITER //
CREATE PROCEDURE VarDemo()
BEGIN
    _______ v_count INT _______ 0;       -- 填空1、填空2：声明变量并设默认值
    _______ v_name VARCHAR(20);          -- 填空3：声明变量关键字
    
    SELECT COUNT(*) INTO v_count FROM student;
    _______ v_name = '测试';              -- 填空4：赋值关键字
    
    SELECT v_count, v_name;
END //
DELIMITER ;

填空1：____declare___
填空2：____default___
填空3：____declare___
填空4：____set___




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 3                                                                    │
│ 补全存储过程：使用 IF 判断成绩等级                                            │
│ 考点：IF... ELSEIF...ELSE...END IF 语法                                       │
└─────────────────────────────────────────────────────────────────────────────┘
*/

DROP PROCEDURE IF EXISTS GetGradeLevel;

DELIMITER //
CREATE PROCEDURE GetGradeLevel(
    IN p_grade INT,
    OUT p_level VARCHAR(10)
)
BEGIN
    _______ p_grade >= 90 _______        -- 填空1、填空2
        SET p_level = '优秀';
    _______ p_grade >= 60 _______        -- 填空3、填空4
        SET p_level = '及格';
    _______                               -- 填空5
        SET p_level = '不及格';
    _______ _______;                      -- 填空6、填空7：结束语句
END //
DELIMITER ;

填空1：___if____
填空2：____then___
填空3：___elseif____
填空4：____then___
填空5：___else____
填空6：___end____
填空7：____if___




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 4                                                                    │
│ 补全存储过程：使用 WHILE 循环计算 1+2+... +n                                   │
│ 考点：WHILE... DO...END WHILE 语法                                            │
└─────────────────────────────────────────────────────────────────────────────┘
*/

DROP PROCEDURE IF EXISTS CalcSum;

DELIMITER //
CREATE PROCEDURE CalcSum(
    IN p_n INT,
    OUT p_sum INT
)
BEGIN
    DECLARE i INT DEFAULT 1;
    SET p_sum = 0;
    
    _______ i <= p_n _______             -- 填空1、填空2
        SET p_sum = p_sum + i;
        SET i = i + 1;
    _______ _______;                      -- 填空3、填空4：结束语句
END //
DELIMITER ;

填空1：___while____
填空2：___do____
填空3：___end____
填空4：___while____




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 5                                                                    │
│ 补全存储过程：使用 LOOP 循环，配合 LEAVE 退出                                 │
│ 考点：LOOP...END LOOP、LEAVE 语法                                            │
└─────────────────────────────────────────────────────────────────────────────┘
*/

DROP PROCEDURE IF EXISTS LoopDemo;

DELIMITER //
CREATE PROCEDURE LoopDemo(
    IN p_n INT,
    OUT p_sum INT
)
BEGIN
    DECLARE i INT DEFAULT 0;
    SET p_sum = 0;
    
    my_loop: _______                      -- 填空1：循环关键字
        SET i = i + 1;
        
        IF i > p_n THEN
            _______ my_loop;              -- 填空2：退出循环关键字
        END IF;
        
        SET p_sum = p_sum + i;
    END _______ my_loop;                  -- 填空3：结束循环关键字
END //
DELIMITER ;

填空1：___loop____
填空2：___leave____
填空3：___loop____




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 6                                                                    │
│ 补全存储过程：使用 REPEAT 循环（先执行后判断）                                │
│ 考点：REPEAT... UNTIL...END REPEAT 语法                                       │
└─────────────────────────────────────────────────────────────────────────────┘
*/

DROP PROCEDURE IF EXISTS RepeatDemo;

DELIMITER //
CREATE PROCEDURE RepeatDemo(
    IN p_n INT,
    OUT p_sum INT
)
BEGIN
    DECLARE i INT DEFAULT 0;
    SET p_sum = 0;
    
    _______                               -- 填空1：循环开始关键字
        SET i = i + 1;
        SET p_sum = p_sum + i;
    _______ i >= p_n                      -- 填空2：条件判断关键字（注意：没有分号！）
    END _______;                          -- 填空3：结束关键字
END //
DELIMITER ;

填空1：___repeat____
填空2：___until____
填空3：___repeat____




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 7                                                                    │
│ 补全存储过程：使用 CASE 分支判断                                              │
│ 考点：CASE WHEN...THEN... ELSE...END CASE 语法                                │
└─────────────────────────────────────────────────────────────────────────────┘
*/

DROP PROCEDURE IF EXISTS CaseDemo;

DELIMITER //
CREATE PROCEDURE CaseDemo(
    IN p_day INT,
    OUT p_name VARCHAR(10)
)
BEGIN
    _______ p_day                         -- 填空1：分支开始关键字
        _______ 1 _______ SET p_name = '周一';   -- 填空2、填空3
        _______ 2 _______ SET p_name = '周二';   -- 填空4、填空5
        _______ SET p_name = '其他';      -- 填空6：默认分支关键字
    _______ _______;                      -- 填空7、填空8：结束语句
END //
DELIMITER ;

填空1：____case___
填空2：____when___
填空3：____then___
填空4：____when___
填空5：____then___
填空6：____else___
填空7：____end___
填空8：____case___




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 8                                                                    │
│ 补全存储过程：INOUT 参数的使用                                                │
│ 考点：INOUT 参数既能传入又能返回                                              │
└─────────────────────────────────────────────────────────────────────────────┘
*/

DROP PROCEDURE IF EXISTS DoubleValue;

DELIMITER //
CREATE PROCEDURE DoubleValue(
    _______ p_value INT                   -- 填空1：参数类型（既输入又输出）
)
BEGIN
    SET p_value = p_value * 2;
END //
DELIMITER ;

-- 调用方式：
-- SET @num = 10;
-- CALL DoubleValue(@num);
-- SELECT @num;  -- 结果应该是 20

填空1：___inout____




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 9                                                                    │
│ 补全存储过程调用语句                                                          │
│ 考点：CALL 语法、用户变量 @                                                   │
└─────────────────────────────────────────────────────────────────────────────┘
*/

-- 假设已有存储过程：
-- CREATE PROCEDURE GetAvgGrade(IN p_sno CHAR(9), OUT p_avg DECIMAL(5,2))

-- 补全调用语句：
_______ GetAvgGrade('001', _______);     -- 填空1：调用关键字；填空2：接收输出的变量
SELECT _______ AS 平均成绩;               -- 填空3：查看结果

填空1：___call____
填空2：___@p_avg____
填空3：___@p_avg____




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 10                                                                   │
│ 补全存储过程：事务处理与异常捕获                                              │
│ 考点：START TRANSACTION、COMMIT、ROLLBACK、HANDLER                           │
└─────────────────────────────────────────────────────────────────────────────┘
*/

DROP PROCEDURE IF EXISTS SafeTransfer;

DELIMITER //
CREATE PROCEDURE SafeTransfer(
    IN p_from VARCHAR(20),
    IN p_to VARCHAR(20),
    IN p_amount DECIMAL(10,2),
    OUT p_result VARCHAR(50)
)
BEGIN
    -- 声明异常处理器
    DECLARE EXIT _______ FOR SQLEXCEPTION  -- 填空1：处理器关键字
    BEGIN
        _______;                           -- 填空2：回滚事务
        SET p_result = '转账失败';
    END;
    
    -- 开启事务
    _______ _______;                       -- 填空3、填空4：开启事务
    
    -- 执行转账逻辑（假设有 account 表）
    -- UPDATE account SET money = money - p_amount WHERE name = p_from;
    -- UPDATE account SET money = money + p_amount WHERE name = p_to;
    
    -- 提交事务
    _______;                               -- 填空5：提交
    SET p_result = '转账成功';
END //
DELIMITER ;

填空1：___handler____
填空2：___rollback____
填空3：___start____
填空4：__transaction_____
填空5：___commit____




-- ═══════════════════════════════════════════════════════════════════════════════
-- 第二部分：存储函数填空题（5题）
-- ═══════════════════════════════════════════════════════════════════════════════

/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 11                                                                   │
│ 补全存储函数：计算学生选课数量                                                │
│ 考点：CREATE FUNCTION、RETURNS、RETURN 语法                                  │
└─────────────────────────────────────────────────────────────────────────────┘
*/

DROP FUNCTION IF EXISTS GetCourseCount;

DELIMITER //
CREATE _______ GetCourseCount(p_sno CHAR(9))  -- 填空1：创建函数关键字
_______ INT                                    -- 填空2：返回类型声明关键字
DETERMINISTIC
BEGIN
    DECLARE v_count INT;
    
    SELECT COUNT(*) INTO v_count
    FROM sc WHERE sno = p_sno;
    
    _______ v_count;                           -- 填空3：返回值关键字
END //
DELIMITER ;

填空1：___function____
填空2：___returns____
填空3：___return____




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 12                                                                   │
│ 补全存储函数：函数特性声明                                                    │
│ 考点：DETERMINISTIC / READS SQL DATA 等特性                                  │
└─────────────────────────────────────────────────────────────────────────────┘
*/

DROP FUNCTION IF EXISTS GetAvgScore;

DELIMITER //
CREATE FUNCTION GetAvgScore(p_sno CHAR(9))
RETURNS DECIMAL(5,2)
_______                                        -- 填空1：表示"相同输入返回相同结果"
BEGIN
    DECLARE v_avg DECIMAL(5,2);
    
    SELECT AVG(grade) INTO v_avg
    FROM sc WHERE sno = p_sno;
    
    RETURN IFNULL(v_avg, 0);
END //
DELIMITER ;

-- 另一个常用特性是 _______ _______ _______  -- 填空2：表示"函数只读取数据，不修改"

填空1：___deterministic____
填空2：___read____ ___sql____ ___data____




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 13                                                                   │
│ 补全存储函数调用语句                                                          │
│ 考点：函数可以嵌入 SELECT 语句中使用                                          │
└─────────────────────────────────────────────────────────────────────────────┘
*/

-- 假设已有函数 GetCourseCount(sno)

-- 方式1：单独调用
_______ GetCourseCount('001');                 -- 填空1：查询关键字

-- 方式2：嵌入查询（查询每个学生及其选课数量）
SELECT sno, sname, _______(sno) AS 选课数     -- 填空2：函数名
FROM student;

填空1：___select____
填空2：___GetCourseCount____




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 14                                                                   │
│ 存储过程 vs 存储函数：判断题                                                  │
│ 考点：两者的核心区别                                                          │
└─────────────────────────────────────────────────────────────────────────────┘
*/

-- 判断以下说法是否正确（填 T 或 F）：

1. 存储过程用 CALL 调用，存储函数用 SELECT 调用        ___T____
2. 存储过程可以有多个返回值（通过 OUT 参数）           ___T____
3. 存储函数必须有且只有一个 RETURN 语句                ___T____
4. 存储函数可以有 OUT 参数                             ___F____
5. 存储函数可以在 SQL 语句中使用（如 SELECT, WHERE）   ___T____
6. 存储过程可以在 SELECT 语句中直接调用                ___F____




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 15                                                                   │
│ 补全存储函数：处理 NULL 值                                                    │
│ 考点：IFNULL 函数的使用                                                       │
└─────────────────────────────────────────────────────────────────────────────┘
*/

DROP FUNCTION IF EXISTS SafeAvg;

DELIMITER //
CREATE FUNCTION SafeAvg(p_sno CHAR(9))
RETURNS DECIMAL(5,2)
DETERMINISTIC
BEGIN
    DECLARE v_avg DECIMAL(5,2);
    
    SELECT AVG(grade) INTO v_avg FROM sc WHERE sno = p_sno;
    
    -- 如果 v_avg 为 NULL，返回 0.00
    RETURN _______(v_avg, 0.00);           -- 填空：NULL 处理函数
END //
DELIMITER ;

填空：___isnull____




-- ═══════════════════════════════════════════════════════════════════════════════
-- 第三部分：游标填空题（5题）
-- ═══════════════════════════════════════════════════════════════════════════════

/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 16                                                                   │
│ 补全游标声明和使用                                                            │
│ 考点：DECLARE CURSOR、OPEN、FETCH、CLOSE 语法                                │
└─────────────────────────────────────────────────────────────────────────────┘
*/

DROP PROCEDURE IF EXISTS CursorDemo;

DELIMITER //
CREATE PROCEDURE CursorDemo()
BEGIN
    -- 1. 声明变量
    DECLARE v_sno CHAR(9);
    DECLARE v_sname VARCHAR(20);
    DECLARE done INT DEFAULT 0;
    
    -- 2. 声明游标
    DECLARE stu_cursor _______ _______     -- 填空1、填空2：游标声明关键字
        SELECT sno, sname FROM student;
    
    -- 3. 声明异常处理器
    DECLARE CONTINUE HANDLER FOR _______ _______ SET done = 1;  -- 填空3、填空4
    
    -- 4. 打开游标
    _______ stu_cursor;                    -- 填空5：打开游标关键字
    
    -- 5. 循环读取
    read_loop: LOOP
        _______ stu_cursor _______ v_sno, v_sname;  -- 填空6、填空7：读取数据
        
        IF done THEN
            LEAVE read_loop;
        END IF;
        
        SELECT CONCAT('学号:', v_sno, ' 姓名:', v_sname);
    END LOOP;
    
    -- 6. 关闭游标
    _______ stu_cursor;                    -- 填空8：关闭游标关键字
END //
DELIMITER ;

填空1：___cursor____
填空2：___for____
填空3：___not____
填空4：___found____
填空5：___open____
填空6：___fetch____
填空7：___into____
填空8：___close____




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 17                                                                   │
│ 游标声明顺序：排序题                                                          │
│ 考点：变量、游标、HANDLER 的声明顺序（非常重要！）                            │
└─────────────────────────────────────────────────────────────────────────────┘
*/

-- 以下三条声明语句，正确的顺序是什么？请填写 A、B、C

-- A:  DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
-- B: DECLARE my_cursor CURSOR FOR SELECT * FROM student;
-- C:  DECLARE v_name VARCHAR(20);

正确顺序：____C___ → ____B___ → ___A____




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 18                                                                   │
│ 补全游标异常处理器                                                            │
│ 考点：NOT FOUND 条件处理                                                      │
└─────────────────────────────────────────────────────────────────────────────┘
*/

-- 当游标读取到结果集末尾时，会触发 NOT FOUND 条件
-- 补全异常处理器声明：

DECLARE _______ HANDLER                    -- 填空1：处理方式（继续执行）
FOR _______ _______                        -- 填空2、填空3：条件
SET done = 1;

填空1：____continue___
填空2：____not___
填空3：____found___




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 19                                                                   │
│ 游标操作判断题                                                                │
│ 考点：游标的使用规则                                                          │
└─────────────────────────────────────────────────────────────────────────────┘
*/

-- 判断以下说法是否正确（填 T 或 F）：

1. 游标必须在使用前 OPEN，使用后 CLOSE               ___T____
2. FETCH 每次读取一行数据                            ____T___
3. 游标关闭后可以直接再次 FETCH                      _____F__
4. 一个存储过程中可以声明多个游标                    ______F_
5. 游标只能在存储过程或存储函数中使用                _______T




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 20                                                                   │
│ 补全使用游标批量更新数据                                                      │
│ 考点：游标配合 UPDATE 语句                                                    │
└─────────────────────────────────────────────────────────────────────────────┘
*/

DROP PROCEDURE IF EXISTS UpdateAllAge;

DELIMITER //
CREATE PROCEDURE UpdateAllAge()
BEGIN
    DECLARE v_sno CHAR(9);
    DECLARE done INT DEFAULT 0;
    
    DECLARE age_cursor CURSOR FOR
        SELECT sno FROM student;
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
    
    _______ age_cursor;                    -- 填空1：打开游标
    
    update_loop: LOOP
        FETCH age_cursor _______ v_sno;    -- 填空2：读取到变量
        
        IF done THEN
            _______ update_loop;           -- 填空3：退出循环
        END IF;
        
        -- 年龄 +1
        UPDATE student SET sage = sage + 1 WHERE sno = v_sno;
    END LOOP;
    
    _______ age_cursor;                    -- 填空4：关闭游标
END //
DELIMITER ;

填空1：___OPEN____
填空2：___into____
填空3：___leave____
填空4：___close____




-- ═══════════════════════════════════════════════════════════════════════════════
-- 第四部分：触发器填空题（5题）
-- ═══════════════════════════════════════════════════════════════════════════════

/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 21                                                                   │
│ 补全 INSERT 触发器                                                            │
│ 考点：CREATE TRIGGER、AFTER/BEFORE、NEW 关键字                               │
└─────────────────────────────────────────────────────────────────────────────┘
*/

-- 创建日志表
DROP TABLE IF EXISTS student_log;
CREATE TABLE student_log (
    id INT PRIMARY KEY AUTO_INCREMENT,
    operation VARCHAR(20),
    sno CHAR(9),
    log_time DATETIME
);

-- 补全触发器：插入学生后记录日志
DROP TRIGGER IF EXISTS tr_student_insert;

DELIMITER //
CREATE _______ tr_student_insert           -- 填空1：创建触发器关键字
_______ INSERT ON student                  -- 填空2：触发时机（插入后）
FOR EACH _______                           -- 填空3：行级触发器关键字
BEGIN
    INSERT INTO student_log (operation, sno, log_time)
    VALUES ('INSERT', _______.sno, NOW()); -- 填空4：新数据关键字
END //
DELIMITER ;

填空1：___trgger____
填空2：___after____
填空3：___row____
填空4：___new____




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 22                                                                   │
│ 补全 UPDATE 触发器                                                            │
│ 考点：OLD 和 NEW 的区别                                                       │
└─────────────────────────────────────────────────────────────────────────────┘
*/

DROP TRIGGER IF EXISTS tr_student_update;

DELIMITER //
CREATE TRIGGER tr_student_update
AFTER UPDATE ON student
FOR EACH ROW
BEGIN
    -- 只有当姓名发生变化时才记录日志
    IF _______.sname != _______.sname THEN   -- 填空1：旧值；填空2：新值
        INSERT INTO student_log (operation, sno, log_time)
        VALUES ('UPDATE', NEW.sno, NOW());
    END IF;
END //
DELIMITER ;

填空1：___new____
填空2：___old____




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 23                                                                   │
│ 补全 DELETE 触发器                                                            │
│ 考点：DELETE 触发器只能用 OLD                                                 │
└─────────────────────────────────────────────────────────────────────────────┘
*/

DROP TRIGGER IF EXISTS tr_student_delete;

DELIMITER //
CREATE TRIGGER tr_student_delete
_______ DELETE ON student                  -- 填空1：触发时机（删除后）
FOR EACH ROW
BEGIN
    INSERT INTO student_log (operation, sno, log_time)
    VALUES ('DELETE', _______.sno, NOW()); -- 填空2：被删除的数据用什么关键字？
END //
DELIMITER ;

填空1：___after____
填空2：___old____




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 24                                                                   │
│ NEW 和 OLD 可用性判断题                                                       │
│ 考点：不同触发事件中 NEW 和 OLD 的可用性                                      │
└─────────────────────────────────────────────────────────────────────────────┘
*/

-- 填写 ✓ 或 ✗ 表示是否可用：

-- |  触发事件  |  NEW  |  OLD  |
-- |------------|-------|-------|
-- |  INSERT    |  __1_  |  _0__  |
-- |  UPDATE    |  _1__  |  _1__  |
-- |  DELETE    |  __0_  |  _1__  |




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 25                                                                   │
│ 补全 BEFORE 触发器：数据校验                                                  │
│ 考点：BEFORE 触发器可以修改 NEW 的值                                          │
└─────────────────────────────────────────────────────────────────────────────┘
*/

DROP TRIGGER IF EXISTS tr_check_age;

DELIMITER //
CREATE TRIGGER tr_check_age
_______ INSERT ON student                  -- 填空1：触发时机（插入前）
FOR EACH ROW
BEGIN
    -- 如果年龄小于0，自动修正为0
    IF NEW. sage < 0 THEN
        SET _______. sage = 0;             -- 填空2：修改新数据
    END IF;
    
    -- 如果年龄大于100，自动修正为100
    IF NEW.sage > 100 THEN
        SET NEW.sage = 100;
    END IF;
END //
DELIMITER ;

填空1：___before____
填空2：___new____




-- ═══════════════════════════════════════════════════════════════════════════════
-- 第五部分：综合填空题（5题）
-- ═══════════════════════════════════════════════════════════════════════════════

/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 26                                                                   │
│ 完整性约束填空                                                                │
│ 考点：三类完整性的实现方式                                                    │
└─────────────────────────────────────────────────────────────────────────────┘
*/

-- 填空：

1. 实体完整性通过 _______ _______ 实现
2. 参照完整性通过 _______ _______ 实现
3. 用户定义完整性通过 _______、_______、_______、_______ 实现




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 27                                                                   │
│ 外键动作填空                                                                  │
│ 考点：ON DELETE / ON UPDATE 的动作选项                                       │
└─────────────────────────────────────────────────────────────────────────────┘
*/

CREATE TABLE child_table (
    id INT PRIMARY KEY,
    parent_id INT,
    FOREIGN KEY (parent_id) REFERENCES parent_table(id)
        ON DELETE _______              -- 填空1：禁止删除父表记录
        ON UPDATE _______              -- 填空2：级联更新子表外键
);

填空1：___district____
填空2：____cascade___




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 28                                                                   │
│ 用户权限管理填空                                                              │
│ 考点：GRANT 和 REVOKE 语法                                                    │
└─────────────────────────────────────────────────────────────────────────────┘
*/

-- 授予用户 zhangsan 对 mydb 数据库所有表的查询权限：
_______ SELECT ON mydb. * _______ 'zhangsan'@'localhost';  -- 填空1、填空2

-- 撤销该权限：
_______ SELECT ON mydb.* _______ 'zhangsan'@'localhost';  -- 填空3、填空4

填空1：____grant___
填空2：___to____
填空3：___revoke____
填空4：___from____




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 29                                                                   │
│ 事务控制填空                                                                  │
│ 考点：事务的 ACID 特性和控制语句                                              │
└─────────────────────────────────────────────────────────────────────────────┘
*/

1.  ACID 四个特性分别是：
   A: _______ (原子性)
   C: _______ (一致性)
   I: _______ (隔离性)
   D: _______ (持久性)

-- 2. 补全事务控制语句：
_______ _______;                           -- 开启事务

UPDATE account SET money = money - 100 WHERE id = 1;
UPDATE account SET money = money + 100 WHERE id = 2;

_______;                                   -- 提交事务（或 ROLLBACK 回滚）




/*
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📌 题目 30                                                                   │
│ 变量类型判断题                                                                │
│ 考点：局部变量、用户变量、系统变量的区别                                      │
└─────────────────────────────────────────────────────────────────────────────┘
*/

-- 判断以下变量属于哪种类型（填：局部变量 / 用户变量 / 系统变量）

1. DECLARE v_count INT DEFAULT 0;       类型：___局部变量____
2. SET @result = 100;                   类型：___用户变量____
3. SELECT @@autocommit;                 类型：___系统变量____
4. SET @@global.max_connections = 200;  类型：___系统变量____




-- ═══════════════════════════════════════════════════════════════════════════════
-- ═══════════════════════════════════════════════════════════════════════════════
--
--                              📋 参考答案
--
-- ═══════════════════════════════════════════════════════════════════════════════
-- ═══════════════════════════════════════════════════════════════════════════════


-- =============================================================================
-- 第一部分：存储过程答案
-- =============================================================================

-- 【题目 1】
-- 填空1：OUT
-- 填空2：INTO

-- 【题目 2】
-- 填空1：DECLARE
-- 填空2：DEFAULT
-- 填空3：DECLARE
-- 填空4：SET

-- 【题目 3】
-- 填空1：IF
-- 填空2：THEN
-- 填空3：ELSEIF
-- 填空4：THEN
-- 填空5：ELSE
-- 填空6：END
-- 填空7：IF

-- 【题目 4】
-- 填空1：WHILE
-- 填空2：DO
-- 填空3：END
-- 填空4：WHILE

-- 【题目 5】
-- 填空1：LOOP
-- 填空2：LEAVE
-- 填空3：LOOP

-- 【题目 6】
-- 填空1：REPEAT
-- 填空2：UNTIL
-- 填空3：REPEAT

-- 【题目 7】
-- 填空1：CASE
-- 填空2：WHEN
-- 填空3：THEN
-- 填空4：WHEN
-- 填空5：THEN
-- 填空6：ELSE
-- 填空7：END
-- 填空8：CASE

-- 【题目 8】
-- 填空1：INOUT

-- 【题目 9】
-- 填空1：CALL
-- 填空2：@avg（或任意用户变量如 @result）
-- 填空3：@avg（与填空2一致）

-- 【题目 10】
-- 填空1：HANDLER
-- 填空2：ROLLBACK
-- 填空3：START
-- 填空4：TRANSACTION
-- 填空5：COMMIT


-- =============================================================================
-- 第二部分：存储函数答案
-- =============================================================================

-- 【题目 11】
-- 填空1：FUNCTION
-- 填空2：RETURNS
-- 填空3：RETURN

-- 【题目 12】
-- 填空1：DETERMINISTIC
-- 填空2：READS SQL DATA

-- 【题目 13】
-- 填空1：SELECT
-- 填空2：GetCourseCount

-- 【题目 14】
-- 1. T（正确）
-- 2. T（正确）
-- 3. T（正确）
-- 4. F（错误，存储函数只有 IN 参数）
-- 5. T（正确）
-- 6. F（错误，存储过程不能在 SELECT 中调用）

-- 【题目 15】
-- 填空：IFNULL


-- =============================================================================
-- 第三部分：游标答案
-- =============================================================================

-- 【题目 16】
-- 填空1：CURSOR
-- 填空2：FOR
-- 填空3：NOT
-- 填空4：FOUND
-- 填空5：OPEN
-- 填空6：FETCH
-- 填空7：INTO
-- 填空8：CLOSE

-- 【题目 17】
-- 正确顺序：C → B → A
-- （变量声明 → 游标声明 → HANDLER 声明）

-- 【题目 18】
-- 填空1：CONTINUE
-- 填空2：NOT
-- 填空3：FOUND

-- 【题目 19】
-- 1. T（正确）
-- 2. T（正确）
-- 3. F（错误，必须重新 OPEN）
-- 4. T（正确）
-- 5. T（正确）

-- 【题目 20】
-- 填空1：OPEN
-- 填空2：INTO
-- 填空3：LEAVE
-- 填空4：CLOSE


-- =============================================================================
-- 第四部分：触发器答案
-- =============================================================================

-- 【题目 21】
-- 填空1：TRIGGER
-- 填空2：AFTER
-- 填空3：ROW
-- 填空4：NEW

-- 【题目 22】
-- 填空1：OLD
-- 填空2：NEW

-- 【题目 23】
-- 填空1：AFTER
-- 填空2：OLD

-- 【题目 24】
-- |  触发事件  |  NEW  |  OLD  |
-- |------------|-------|-------|
-- |  INSERT    |   ✓   |   ✗   |
-- |  UPDATE    |   ✓   |   ✓   |
-- |  DELETE    |   ✗   |   ✓   |

-- 【题目 25】
-- 填空1：BEFORE
-- 填空2：NEW


-- =============================================================================
-- 第五部分：综合题答案
-- =============================================================================

-- 【题目 26】
-- 1. PRIMARY KEY
-- 2. FOREIGN KEY
-- 3. CHECK、NOT NULL、UNIQUE、DEFAULT

-- 【题目 27】
-- 填空1：RESTRICT
-- 填空2：CASCADE

-- 【题目 28】
-- 填空1：GRANT
-- 填空2：TO
-- 填空3：REVOKE
-- 填空4：FROM

-- 【题目 29】
-- ACID：Atomicity、Consistency、Isolation、Durability
-- 事务控制：START TRANSACTION ...  COMMIT

-- 【题目 30】
-- 1. 局部变量
-- 2. 用户变量
-- 3. 系统变量（会话级）
-- 4. 系统变量（全局级）


-- ═══════════════════════════════════════════════════════════════════════════════
-- 📊 题目统计
-- ═══════════════════════════════════════════════════════════════════════════════

/*
┌─────────────────────────────────────────────────────────────────────────────┐
│                           📊 练习题统计                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   题型                    题号              数量                             │
│   ──────────────────────────────────────────────────────                    │
│   存储过程填空            1-10              10 题                            │
│   存储函数填空            11-15             5 题                             │
│   游标填空                16-20             5 题                             │
│   触发器填空              21-25             5 题                             │
│   综合填空                26-30             5 题                             │
│   ──────────────────────────────────────────────────────                    │
│   合计                                      30 题                            │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   🎯 重点易错点：                                                            │
│      ✅ OUT vs INOUT 参数区别                                                │
│      ✅ RETURNS vs RETURN（函数声明 vs 返回值）                              │
│      ✅ WHILE... DO vs REPEAT... UNTIL 语法差异                                │
│      ✅ 游标声明顺序：变量 → 游标 → HANDLER                                  │
│      ✅ NEW/OLD 在不同触发事件中的可用性                                     │
│      ✅ BEFORE 可以修改 NEW，AFTER 不能                                      │
│      ✅ GRANT... TO vs REVOKE...FROM                                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

🎉 Day 2 练习完成！祝你考试顺利！💪
*/